"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4293],{64655:function(e,t,n){n.d(t,{HN:function(){return u},SE:function(){return s},Tx:function(){return l}});var r=n(89992),i=n(88075),a=n(49793),o=n(83056),c=n(27957);let u=(e,t)=>{let{account:n,activeOrganization:u}=(0,i.t)(),s=t===(null==n?void 0:n.uuid),l=null==u?void 0:u.uuid,d=(0,o.useQueryClient)(),f=(0,c.Gm)();return(0,r.uC)(()=>"/api/organizations/".concat(l,"/projects/").concat(e,"/accounts/").concat(t),"PUT",{onSuccess:()=>{d.invalidateQueries([a.l3,{projectUuid:e}]),s&&(f(e),d.invalidateQueries([a.VH,{orgUUID:l}]),d.invalidateQueries([a.tv,{orgUUID:l}]))}})},s=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,i.t)(),o=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(o,"/projects/").concat(e,"/accounts"),{queryKey:[a.l3,{projectUuid:e}],enabled:!!(t&&n&&e),staleTime:0})},l=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,c=(0,o.useQueryClient)();return(0,r.uC)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts/").concat(t.accountUuid),"PUT",{onSuccess:()=>{c.invalidateQueries([a.l3,{projectUuid:e}])},transformVariables:e=>({role:e.role})})}},48970:function(e,t,n){n.d(t,{ER:function(){return l},Kf:function(){return u},Zy:function(){return f},h4:function(){return p},i9:function(){return c},op:function(){return d},pK:function(){return m},u3:function(){return s}});var r=n(89992),i=n(88075);n(65490);var a=n(49793),o=n(83056);let c="[ANT ONLY] synced_resources.txt";function u(e){let{projectUuid:t,suspense:n=!1}=e,{activeOrganization:o}=(0,i.t)(),u=null==o?void 0:o.uuid,{data:s,...l}=(0,r.WE)("/api/organizations/".concat(u,"/projects/").concat(t,"/docs"),{queryKey:[a.zy,{orgUuid:u,projectUuid:t}],enabled:!!o&&!!t,suspense:n});return{data:null==s?void 0:s.filter(e=>{let{file_name:t,content:n}=e;return t.length>0&&n.length>0}).filter(e=>{let{file_name:t}=e;return t!==c}),unfilteredData:s,...l}}function s(e){let{projectUuid:t}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:c}=(0,i.t)(),u=null==c?void 0:c.uuid,s=(0,o.useQueryClient)();return(0,r.uC)(()=>"/api/organizations/".concat(u,"/projects/").concat(t,"/docs"),"POST",{enabled:!!t,onSuccess:function(){for(var e,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];s.invalidateQueries([a.zy,{orgUuid:u,projectUuid:t}]),s.invalidateQueries([a.n$,{orgUuid:u}]),s.invalidateQueries([a.VH,{orgUUID:u}]),null===(e=n.onSuccess)||void 0===e||e.call(n,...i)},onError:function(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];null===(e=n.onError)||void 0===e||e.call(n,...r)}})}function l(e){let{projectUuid:t}=e,{activeOrganization:n}=(0,i.t)(),c=null==n?void 0:n.uuid,u=(0,o.useQueryClient)();return(0,r.Ne)(e=>"/api/organizations/".concat(c,"/projects/").concat(t,"/docs/").concat(e.docUuid),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e.docUuid):t,{queryKey:[a.zy,{orgUuid:c,projectUuid:t}],enabled:!!t,onSuccess:(e,n)=>{u.invalidateQueries([a.tt,{orgUuid:c,projectUuid:t,docUuid:n.docUuid}]),u.invalidateQueries([a.zy,{orgUuid:c,projectUuid:t}]),u.invalidateQueries([a.n$,{orgUuid:c}]),u.invalidateQueries([a.VH,{orgUUID:c}])}})}let d=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,i.t)(),c=null==n?void 0:n.uuid,u=(0,o.useQueryClient)();return(0,r.Ne)(()=>"/api/organizations/".concat(c,"/projects/").concat(t,"/docs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.doc_uuids.includes(t.uuid)):t,{queryKey:[a.zy,{orgUuid:c,projectUuid:t}],enabled:!!t,onSuccess:(e,n)=>{for(let e of n.doc_uuids)u.invalidateQueries([a.tt,{orgUuid:c,projectUuid:t,docUuid:e}]);u.invalidateQueries([a.zy,{orgUuid:c,projectUuid:t}]),u.invalidateQueries([a.n$,{orgUuid:c}]),u.invalidateQueries([a.VH,{orgUUID:c}])}})};function f(e){let{projectUuid:t}=e,{activeOrganization:n}=(0,i.t)(),c=null==n?void 0:n.uuid,u=(0,o.useQueryClient)();return(0,r.Ne)(e=>"/api/organizations/".concat(c,"/projects/").concat(t,"/docs/").concat(e.docUuid),"PUT",(e,t)=>t?t.map(t=>t.uuid===e.docUuid?{...t,...e}:t):t,{queryKey:[a.zy,{orgUuid:c,projectUuid:t}],enabled:!!t,onSuccess:(e,n)=>{u.invalidateQueries([a.tt,{orgUuid:c,projectUuid:t,docUuid:n.docUuid}]),u.invalidateQueries([a.zy,{orgUuid:c,projectUuid:t}]),u.invalidateQueries([a.n$,{orgUuid:c}]),u.invalidateQueries([a.VH,{orgUUID:c}])}})}function p(e){let{projectUuid:t}=e,{activeOrganization:n}=(0,i.t)(),c=null==n?void 0:n.uuid,u=(0,o.useQueryClient)();return(0,r.Ne)(()=>"/api/organizations/".concat(c,"/projects/").concat(t,"/files/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.file_uuids.includes(t.file_uuid)):t,{queryKey:[a.jb,{orgUuid:c,projectUuid:t}],enabled:!!t,onSuccess:()=>{u.invalidateQueries([a.jb,{orgUuid:c,projectUuid:t}]),u.invalidateQueries([a.n$,{orgUuid:c}]),u.invalidateQueries([a.VH,{orgUUID:c}])}})}function m(e){let{projectUuid:t}=e,{activeOrganization:n}=(0,i.t)(),o=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(o,"/projects/").concat(t,"/files"),{queryKey:[a.jb,{orgUuid:o,projectUuid:t}],enabled:!!n&&!!t})}},27957:function(e,t,n){n.d(t,{Gm:function(){return U},Kn:function(){return C},L8:function(){return w},O3:function(){return p},Qs:function(){return g},Yc:function(){return v},bQ:function(){return m},dY:function(){return y},iR:function(){return E},u0:function(){return h}});var r=n(91014),i=n(89992),a=n(88075),o=n(65490),c=n(49793),u=n(83056),s=n(10751),l=n.n(s),d=n(7653),f=n(69602);let p=()=>{let{activeOrganization:e}=(0,a.t)(),t=(0,f.U)(),n=null==e?void 0:e.uuid;return(0,i.WE)("/api/organizations/".concat(n,"/projects"),{queryKey:[c.gi,{orgUuid:n}],enabled:!!(e&&t),staleTime:0,select:e=>e.filter(e=>!e.archived_at)})},m=()=>{let{data:e,isLoading:t}=p();return{data:null==e?void 0:e.filter(e=>e.is_starred),isLoading:t}},h=()=>{let{data:e,isLoading:t}=(0,r.QR)(),{data:n,isLoading:i}=p();return(0,d.useMemo)(()=>{if(t||i)return{data:n,isLoading:!0};if(!n||!e)return{data:n,isLoading:!1};let r=n.map(t=>({...t,lastConversation:null==e?void 0:e.find(e=>e.project_uuid===t.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),a=null==n?void 0:n.filter(e=>!r.find(t=>t.uuid===e.uuid));return{data:[...r,...a],isLoading:!1}},[n,e,t,i])},v=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.t)(),r=null==n?void 0:n.uuid;return(0,i.WE)("/api/organizations/".concat(r,"/projects/").concat(t),{queryKey:[c.$T,{orgUuid:r,projectUuid:t}],enabled:!!(n&&t),staleTime:0,meta:{noToast:e=>e instanceof o.Hx&&404===e.statusCode}})},g=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,n=(0,u.useQueryClient)();return(0,i.uC)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries([c.gi,{orgUuid:t}]),n.invalidateQueries([c.n$,{orgUuid:t}])}})},y=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.t)(),r=null==n?void 0:n.uuid,o=U();return(0,i.Ne)(()=>"/api/organizations/".concat(r,"/projects/").concat(t),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{o(t)},queryKey:[c.$T,{orgUuid:r,projectUuid:t}]})},w=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.t)(),r=null==n?void 0:n.uuid,o=U();return(0,i.uC)(()=>"/api/organizations/".concat(r,"/projects/").concat(t),"DELETE",{onSuccess:()=>{o(t)}})},E=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.t)(),r=null==n?void 0:n.uuid;return(0,i.WE)("/api/organizations/".concat(r,"/projects/").concat(t,"/conversations"),{queryKey:[c.lx,{orgUuid:r,projectUuid:t}],enabled:!!n,staleTime:0,select:e=>l()(e,e=>new Date(e.updated_at)).reverse()})},C=()=>{var e,t;let n=p(),r=null===(t=n.data)||void 0===t?void 0:null===(e=t.find(e=>e.is_starter_project))||void 0===e?void 0:e.uuid;return{...n,data:r}},U=()=>{let{activeOrganization:e}=(0,a.t)(),t=null==e?void 0:e.uuid,n=(0,u.useQueryClient)();return e=>{n.invalidateQueries([c.$T,{orgUuid:t,projectUuid:e}]),n.invalidateQueries([c.gi,{orgUuid:t}]),n.invalidateQueries([c.n$,{orgUuid:t}]),n.invalidateQueries([c.lx,{orgUuid:t,projectUuid:e}])}}},69602:function(e,t,n){n.d(t,{U:function(){return i}});var r=n(88075);let i=()=>{let e=(0,r.ZJ)();return(0,r.Cf)()||e}},93456:function(e,t,n){n.d(t,{M:function(){return p},Y:function(){return m}});var r=n(27573),i=n(20504),a=n(90345),o=n.n(a),c=n(67754),u=n(7653);function s(e,t){switch(t.type){case"DRAW_SVG":return{...e,selectedItem:{type:"svg",data:t.svg}};case"CLOSE_CHAT_SIDEBAR":return{...e,isChatSidebarOpen:!1};case"OPEN_CHAT_SIDEBAR":return{...e,isChatSidebarOpen:!0};case"SELECT_ATTACHMENT":return{...e,selectedItem:{type:"attachment",attachment:t.attachment}};case"SELECT_ARTIFACT":return{...e,selectedItem:{type:"artifact",id:t.id,versionUUID:t.versionUUID}};case"SELECT_DOC":return{...e,selectedItem:{type:"doc",id:t.id}};case"SELECT_SYNCED_DIRECTORY":return{...e,selectedItem:{type:"syncedDirectory",id:t.id}};case"CLEAR_SELECTED":return{...e,selectedItem:null,activeMessageUUID:void 0};case"SET_ACTIVE_MESSAGE_UUID":return{...e,activeMessageUUID:t.uuid};case"UPDATE_ARTIFACTS":return{...e,artifacts:t.artifacts};case"UPDATE_ATTACHMENTS":return{...e,attachments:t.attachments};case"UPDATE_FILES":return{...e,files:t.files};case"UPDATE_SYNC_SOURCES":return{...e,syncSources:t.syncSources};case"UPDATE_DOC_UPDATES":return{...e,docUpdates:t.updates};case"UPDATE_FILE_EDITS":return{...e,fileEdits:t.edits};default:return e}}let l={selectedItem:null,artifacts:{},attachments:[],files:[],syncSources:[],docUpdates:[],fileEdits:new Map,isChatSidebarOpen:!1,activeMessageUUID:void 0,conversationUUID:void 0},d={chatResourceState:l,dispatchChatResource:o()},f=(0,u.createContext)(d);function p(e){let{children:t,conversationUUID:n}=e,a=function(e){let t=!!(0,c.useSearchParams)().get("controls")&&!(window.matchMedia&&window.matchMedia("(max-width: 767px)").matches),[n]=(0,i.Rr)("".concat(e,":chatControlsSidebarIsOpen"),t);return n}(n),[o,d]=(0,u.useReducer)(s,{...l,isChatSidebarOpen:a,conversationUUID:n});return(0,r.jsx)(f.Provider,{value:{chatResourceState:o,dispatchChatResource:d},children:t})}function m(){return(0,u.useContext)(f)}},74293:function(e,t,n){n.d(t,{r:function(){return m},s:function(){return h}});var r=n(27573),i=n(21468),a=n(32751),o=n(1984),c=n(90345),u=n.n(c),s=n(7653),l=n(93456),d=n(51087);let f=(0,s.createContext)(null),p={getInstance:()=>void 0,removeInstance:u(),setBaseContent:u(),flagForDeletion:u(),getCurrentContent:()=>void 0,hasUnsavedChanges:()=>!1,registerEditor:u(),unregisterEditor:u(),setMergeState:()=>u(),subscribeToMergeStateChanges:()=>u(),acceptAllChanges:u(),rejectAllChanges:u(),activeEditors:[],changesMode:!1};function m(e){let{children:t}=e,{track:n}=(0,i.z$)(),{openedFiles:c}=(0,d.b)(),{dispatchChatResource:u}=(0,l.Y)(),p=(0,s.useRef)(new Map),m=(0,s.useCallback)(e=>{p.current.delete(e)},[]),h=(0,s.useRef)(new Set),v=(0,s.useCallback)((e,t)=>{p.current.set(e,{view:t})},[]),g=(0,s.useCallback)(e=>{p.current.delete(e)},[]),y=(0,s.useCallback)((e,t)=>{let n=p.current.get(e);if(!n){a.v("Attempted to set base content for unknown editor: ".concat(e));return}p.current.set(e,{...n,baseContent:t})},[]),w=(0,s.useCallback)(e=>{let t=p.current.get(e);if(!t){a.v("Attempted to flag for deletion for unknown editor: ".concat(e));return}p.current.set(e,{...t,filePendingDeletion:!0})},[]),E=(0,s.useCallback)((e,t)=>{let n=p.current.get(e);n&&(p.current.set(e,{...n,mergeState:t}),h.current.forEach(n=>{n(e,t)}))},[]),C=(0,s.useCallback)(e=>(h.current.add(e),()=>{h.current.delete(e)}),[]),U=(0,s.useCallback)(e=>p.current.get(e),[]),[b,S]=(0,s.useState)([]),[_,I]=(0,s.useState)(!1),x=(0,s.useCallback)(()=>{u({type:"UPDATE_FILE_EDITS",edits:new Map}),I(!1)},[u]);(0,s.useEffect)(()=>{b.length>0&&I(!0)},[b]),(0,s.useEffect)(()=>(S(c.filter(e=>{var t;let n=U(e);return!!n&&(null===(t=n.mergeState)||void 0===t?void 0:t.isActive)&&!!n.view})),C((e,t)=>{S(n=>{var r;let i=n.includes(e),a=t.isActive&&!!(null===(r=U(e))||void 0===r?void 0:r.view);return i===a?n:a?[...n,e]:n.filter(t=>t!==e)})})),[c,C,U]);let T=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b.forEach(n=>{var r;let i=null===(r=U(n))||void 0===r?void 0:r.view;if(!i)return;let a=!0;for(;a;){let t=(0,o.Sk)(i.state);if(!t||0===t.chunks.length){a=!1;continue}let n=t.chunks[0];("accept"===e?o.bN:o.A)(i,n.fromB)||(a=!1)}t&&E(n,{isActive:!1})})},[b,U,E]),j=(0,s.useCallback)(()=>{x(),T("accept"),n({event_key:"harmony.suggestion.accepted"})},[T,n,x]),D=(0,s.useCallback)(()=>{x(),T("reject",!0),n({event_key:"harmony.suggestion.rejected"})},[T,n,x]),A=(0,s.useCallback)(e=>{let t=U(e);if(!t)return;let n=t.view;if(n)return n.state.doc.toString()},[U]),P=(0,s.useCallback)(e=>{let t=U(e);if(!t)return!1;let n=t.view;return!!n&&n.state.doc.toString()!==t.baseContent},[U]),z=(0,s.useMemo)(()=>({getInstance:U,removeInstance:m,setBaseContent:y,flagForDeletion:w,getCurrentContent:A,hasUnsavedChanges:P,registerEditor:v,unregisterEditor:g,setMergeState:E,subscribeToMergeStateChanges:C,acceptAllChanges:j,rejectAllChanges:D,activeEditors:b,changesMode:_}),[U,m,y,w,A,P,v,g,E,C,j,D,b,_]);return(0,r.jsx)(f.Provider,{value:z,children:t})}function h(){return(0,s.useContext)(f)||p}},65380:function(e,t,n){n.d(t,{KA:function(){return s},Nc:function(){return u},YB:function(){return c},b8:function(){return a},h4:function(){return o}});var r=n(35567),i=n.n(r);function a(e,t){return i()(e,t)}function o(e){let t=[],n=0;for(let[r,i]of e)0!==r&&t.push({op:r,pos:n,text:i}),-1!==r&&(n+=i.length);return t}function c(e){if(!Array.isArray(e))throw Error("Input must be an array");e.forEach((e,t)=>{if(!("object"==typeof e&&null!==e&&"op"in e&&"number"==typeof e.op))throw Error("Invalid change object at index ".concat(t));if(1!==e.op&&-1!==e.op)throw Error("Invalid 'op' value at index ".concat(t));if("number"!=typeof e.pos||!Number.isInteger(e.pos))throw Error("Invalid 'pos' value at index ".concat(t));if("string"!=typeof e.text)throw Error("Invalid 'text' value at index ".concat(t))})}function u(e,t){return function(e,t){let n=e,r=0;for(let e of t){let t=e.pos+r;1===e.op?(n=n.slice(0,t)+e.text+n.slice(t),r+=e.text.length):-1===e.op&&(n=n.slice(0,t)+n.slice(t+e.text.length),r-=e.text.length)}return n}(e,t.map(e=>({op:-e.op,pos:e.pos,text:e.text})).reverse())}function s(e){for(let[t]of e)if(0!==t)return!1;return!0}},2550:function(e,t,n){function r(e){var t;return(null===(t=e.mergeState)||void 0===t?void 0:t.isActive)?e.mergeState.diffSource||"":e.view.state.doc.toString()||""}function i(e){return r(e)!==e.baseContent}n.d(t,{li:function(){return r},oI:function(){return i}}),n(65380)},3909:function(e,t,n){n.d(t,{G:function(){return a}});var r=n(68068),i=n.n(r);function a(e){return i().createHash("sha256").update(e.trim()).digest("hex").slice(0,6)}},95950:function(e,t,n){n.d(t,{Y:function(){return c}});var r=n(88075),i=n(48644),a=n(64655),o=n(27957);let c=e=>{var t;let{account:n}=(0,r.t)(),{data:c,isLoading:u}=(0,o.Yc)({projectUuid:e}),{data:s,isLoading:l}=(0,a.SE)(e||""),d=null!==(t=null==s?void 0:s.some(e=>e.account.uuid===(null==n?void 0:n.uuid)&&"user"===e.role))&&void 0!==t&&t,f="showDirectoryPicker"in window&&"FileSystemHandle"in window,p=(0,i.useConfig)("harmony").config;return{userHasHarmony:f&&(null==n?void 0:n.settings.preview_feature_uses_harmony)&&(null==p?void 0:p.get("harmonize",!1)),projectHasHarmony:!u&&!l&&d&&!!(null==c?void 0:c.is_harmony_project),config:p}}},51087:function(e,t,n){n.d(t,{C:function(){return E},b:function(){return C}});var r=n(27573),i=n(7653),a=n(90345),o=n.n(a);let c=(0,i.createContext)(null),u={openedFiles:[],projectDocs:[],files:[],setFiles:o(),projectUuid:"",syncedDirectories:[],setSyncedDirectories:o()};function s(e){let{children:t,onLoad:n}=e;return(0,i.useEffect)(n,[n]),(0,r.jsx)(c.Provider,{value:u,children:t})}var l=n(32751),d=n(20053),f=n.n(d),p=n(3982),m=n(48970),h=n(769),v=n(12063),g=n(1373);function y(e){let{children:t,onLoad:n,projectUuid:a}=e,{isLoading:o,unfilteredData:u=[]}=(0,m.Kf)({projectUuid:a,suspense:!0}),[s,d]=(0,i.useState)([]),[y,w]=(0,i.useState)([]),E=(0,i.useMemo)(()=>[...(function(e,t){let n=new Map,r=t.filter(g.IQ).map(e=>e.uri);if(!r.length)return n;for(let t of r){let r=new Set;for(let n of e){if(!(0,g.Wx)(n.file_name))continue;let{projectUuid:e,directoryUuid:i}=(0,g.Xp)(n.file_name),a=(0,g.Xp)(t);e===a.projectUuid&&i===a.directoryUuid&&r.add(n.file_name)}n.set(t,r)}return n})(u,s).values()].flatMap(e=>[...e]),[u,s]);(0,i.useEffect)(()=>{(0,h.Zz)(a).then(w).catch(e=>l.v("Harmony: Error initializing synced directories from IndexedDB",e))},[a]);let{mutateAsync:C}=(0,m.u3)({projectUuid:a}),{mutateAsync:U}=(0,m.Zy)({projectUuid:a}),{mutateAsync:b}=(0,m.ER)({projectUuid:a}),S=(0,i.useCallback)(()=>{(0,v.tt)(a,o,s,u,C,U,b).then(e=>{e&&(f()(s,e.updatedFiles)||(d(e.updatedFiles),l.f("Harmony: Resynced ".concat(e.updatedFiles.filter(g.zE).length," files in ").concat(e.updatedFiles.filter(g.IQ).length," directories")),n()))}).catch(e=>l.v("Harmony: Error during resync:",e))},[a,o,s,u,C,U,b,n]);(0,i.useEffect)(S,[S]),(0,p.Yz)(S,3e4);let _=(0,i.useMemo)(()=>({projectUuid:a,openedFiles:E,projectDocs:u,files:s,setFiles:d,syncedDirectories:y,setSyncedDirectories:w}),[a,E,u,s,y,w]);return(0,r.jsx)(c.Provider,{value:_,children:t})}var w=n(95950);function E(e){let{children:t,onLoad:n,projectUuid:i}=e,{userHasHarmony:a}=(0,w.Y)(i);return a?(0,r.jsx)(y,{onLoad:n,projectUuid:i,children:t}):(0,r.jsx)(s,{onLoad:n,children:t})}function C(){return(0,i.useContext)(c)||u}},769:function(e,t,n){n.d(t,{Gz:function(){return f},U4:function(){return p},Zz:function(){return d},y3:function(){return m}});var r=n(32751),i=n(71994),a=n(1373);let o="directories",c="projectUuid",u=null;async function s(){return u||new Promise((e,t)=>{let n=indexedDB.open("harmony",1);n.onerror=()=>t(n.error),n.onsuccess=()=>{(u=n.result).onerror=e=>{r.v("Database error:",e)},u.onclose=()=>{u=null},e(u)},n.onupgradeneeded=e=>{e.target.result.createObjectStore(o,{keyPath:"uuid"}).createIndex(c,"projectUuid",{unique:!1})}})}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"readonly";if(!u)throw Error("Database not initialized");return u.transaction(o,e)}async function d(e){await s();let t=l("readonly").objectStore(o).index(c);return new Promise((n,r)=>{let i=t.getAll(e);i.onerror=()=>r(i.error),i.onsuccess=()=>{n(i.result.map(e=>({...e,uri:(0,a.cT)(e)})))}})}async function f(e){await s();let t={...e,uuid:(0,i.H)()};return new Promise((e,n)=>{let i=l("readwrite").objectStore(o).add(t);i.onerror=()=>n(i.error),i.onsuccess=()=>{let n=(0,a.cT)(t);e({...t,uri:n}),r.f("Harmony: Synced directory added to IndexedDB",t)}})}async function p(e){return await s(),new Promise((t,n)=>{let r=l("readwrite").objectStore(o).put(e);r.onerror=()=>n(r.error),r.onsuccess=()=>t()})}async function m(e){return await s(),new Promise((t,n)=>{let r=l("readwrite").objectStore(o).delete(e);r.onerror=()=>n(r.error),r.onsuccess=()=>t()})}},12063:function(e,t,n){n.d(t,{Jl:function(){return m},wC:function(){return E},T7:function(){return b},bE:function(){return f},lz:function(){return U},xF:function(){return v},Zn:function(){return C},cM:function(){return w},tt:function(){return S},KT:function(){return p},ec:function(){return h}});var r=n(32751),i=n(20053),a=n.n(i),o=n(48970),c=n(65380),u=n(2550),s=n(3909),l=n(769),d=n(1373);async function f(e){let t=await (0,l.Zz)(e);return await (0,d.C7)(t)}async function p(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=await Promise.all(t.filter(d.zE).map(async t=>({path:t.uri,content:await m(e,t.uri)})));return new Promise((e,t)=>{let c=new Worker(n.tu(new URL(n.p+n.u(6269),n.b))),u=setTimeout(()=>{t(Error("Search timeout"))},3e4),s=()=>{c.terminate(),clearTimeout(u)};c.onerror=e=>{s(),t(e)};let l=[];c.onmessage=t=>{let{type:n,results:r}=t.data;l.push(...r),"complete"===n&&(s(),e(l))},c.postMessage({files:o,searchTerm:r,isRegex:i,caseSensitive:a})})}async function m(e,t){return(await (0,d.pJ)(e,t)).text}async function h(e,t,n,i,a,o){let s=await (0,l.Zz)(t),f=Array.from(new Set([...e])).map(async e=>{if((0,d.Wx)(e))try{let t=o(e),l=t?(0,u.li)(t):void 0,d=t?t.baseContent:void 0;if(void 0===d||void 0===l){let t=await m(s,e);if(!l){if(null===t){r.v(Error("File content not found for ".concat(e)));return}return await g(n,i,a,e,t,[])}return await g(n,i,a,e,l,(0,c.b8)(t||"",l))}let f=(0,c.b8)(d,l);return await g(n,i,a,e,l,f)}catch(t){r.v("Error processing file ".concat(e,":"),t)}});await Promise.all(f)}async function v(e,t,n,r,i){let a=await m(e,i);if(null===a)throw Error("File content not found for ".concat(i));if(new TextEncoder().encode(a).length>102400)throw Error("File ".concat(i," is too large and will degrade the experience. Pass a specific view_range when using the view tool for this file."));return await g(t,n,r,i,a)}async function g(e,t,n,r,i,a){let o=e.find(e=>e.file_name===r);if(o&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.match(/<content>([\s\S]*)<\/content>/),r=n&&n[1]?n[1].trim():e;if(t){let t=e.match(/<changes>(.*?)<\/changes>/);if(t&&t[1]){let e=JSON.parse(t[1]);(0,c.YB)(e),r=(0,c.Nc)(r,e)}}return r}(o.content)===i)return o;let u=function(e,t){let n=(0,s.G)(e),r=void 0!==t&&!(0,c.KA)(t);return"\n<metadata>\n<file_hash>".concat(n,"</file_hash>\n<file_state>\n  ").concat(r&&void 0!==t?"\n  <status>includes_unsaved_changes</status>\n  <message>This content includes modifications since it was last synchronized. You can and should continue to suggest changes using write or replace operations. Your suggestions will be applied to the latest version of the file. THIS IS THE MOST UP TO DATE VERSION OF THE FILE.</message>\n  <changes>".concat(JSON.stringify((0,c.h4)(t)),"</changes>\n"):"<status>synced</status>","\n</file_state>\n</metadata>\n<content>").concat(e,"</content>\n").trim()}(i,a);return o?await n({docUuid:o.uuid,content:u}):await t({file_name:r,content:u})}async function y(e,t,n,i,a){if(0===e.length){let e=t.find(e=>e.file_name===o.i9);e&&await a({docUuid:e.uuid});return}let c=JSON.stringify(e.map(e=>e.uri),null,2).split("\n"),u=c.slice(0,50).join("\n"),s=c.length-50,l="<synced_resources>\n".concat(u,"\n").concat(s>0?"\n... plus ".concat(s," additional files."):"","\n</synced_resources>"),d=t.filter(e=>e.file_name===o.i9);if(d.length>0){let[e,...n]=d;if(n.length>0&&r.f("Harmony: Cleaning up ".concat(n.length," extra project docs")),await Promise.all(n.map(e=>w(t,e.file_name,a))),e.content===l){r.f("Harmony: Project doc already up to date",e.uuid);return}await i({docUuid:e.uuid,content:l}),r.f("Harmony: Updated project doc",e.uuid)}else{let e=await n({file_name:o.i9,content:l});r.f("Harmony: Created project doc",e.uuid)}}async function w(e,t,n){let r=e.find(e=>e.file_name===t);r&&await n({docUuid:r.uuid})}async function E(e,t,n,r){let{projectUuid:i,directoryUuid:a}=(0,d.Xp)(r),o=(0,d.wq)(e,i,a);for(let e of(await (0,l.y3)(a),t.filter(e=>U(e,o))))await n({docUuid:e.uuid});return e.filter(e=>e!==o)}async function C(e,t,n){let r=await (0,d.mf)(e,null!=n?n:[]);if(r.descendants.length>2500)throw Error("The size of this directory may cause performance degredation. Please choose a smaller directory.");return await (0,l.Gz)({projectUuid:t,root:r,ignorePatterns:null!=n?n:[],lastUpdated:Date.now()})}function U(e,t){if(!(0,d.Wx)(e.file_name))return!1;let{projectUuid:n,directoryUuid:r}=(0,d.Xp)(t.uri),{projectUuid:i,directoryUuid:a}=(0,d.Xp)(e.file_name);return n===i&&r===a}function b(e){let t=e.split("/"),n=t[t.length-1],r=t[t.length-2];return""===n||"."===n?"".concat(r,"/"):n}async function S(e,t,n,r,i,o,c){if(!e||t)return;let u=await (0,l.Zz)(e),s=await (0,d.C7)(u);if(!a()(n.map(e=>e.uri),s.map(e=>e.uri))){for(let e of u)e.root.descendants.some(t=>t.lastModified>e.lastUpdated)&&await (0,l.U4)({...e,lastUpdated:Date.now()});return await y(s,r,i,o,c),{updatedFiles:s}}}},1373:function(e,t,n){n.d(t,{cn:function(){return v},_I:function(){return g},wq:function(){return U},sy:function(){return b},IQ:function(){return E},zE:function(){return C},Wx:function(){return z},C7:function(){return y},mf:function(){return x},Xp:function(){return P},M9:function(){return R},pJ:function(){return f},cT:function(){return _},NC:function(){return p}});var r=n(49456),i=n(32751),a=n(36758);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}getCacheKey(e,t){return"".concat(e.name,"-").concat(t)}isPermissionExpired(e){return Date.now()-e>this.CACHE_DURATION}async checkPermission(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"read",n=this.getCacheKey(e,t),r=this.permissionCache.get(n);if(r&&!this.isPermissionExpired(r.timestamp))return"granted"===r.state;try{if("queryPermission"in e){let r=await e.queryPermission({mode:t});if("granted"===r)return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}if("requestPermission"in e){let r=await e.requestPermission({mode:t});return this.permissionCache.set(n,{state:r,timestamp:Date.now(),mode:t}),"granted"===r}return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}catch(e){return i.v("Permission check failed:",e),this.permissionCache.set(n,{state:"denied",timestamp:Date.now(),mode:t}),!1}}constructor(){this.permissionCache=new Map,this.CACHE_DURATION=36e5}}let c=o.getInstance();async function u(e,t){return c.checkPermission(e,t)}var s=n(46385).Buffer;let l="inode/directory";async function d(e,t){let n=await e.getFile();return{handle:e,path:"".concat(t,"/").concat(n.name),lastModified:n.lastModified}}async function f(e,t){let n,i;let{directory:a,file:o}=b(e,t);if(!o)throw Error("File not found: ".concat(t));let c=await o.handle.getFile(),u=null;try{u=await (0,r.CL)(c),i=c.type||"text/plain"}catch(t){let e=await c.arrayBuffer();n=e.byteLength>1048576?"[File truncated due to size]":s.from(e).toString("base64"),i=c.type||"application/octet-stream"}return{uri:S(a,o),mimeType:i,text:u,blob:n}}async function p(e,t){if(!await u(e.handle,"readwrite"))throw Error("Permission denied");let n=await e.handle.getFile();try{await (0,r.CL)(n)}catch(e){throw Error("Cannot write to non-text files")}let a=await e.handle.createWritable();try{await a.write(t)}finally{await a.close()}i.f("Harmony: Wrote file ".concat(e.path," to local file system")),e.lastModified=Date.now()}async function m(e,t){try{return await e.getDirectoryHandle(t,{create:!0})}catch(e){throw Error("Failed to create directory ".concat(t))}}async function h(e,t){let n=e;for(let e=0;e<t.length-1;e++)n=await m(n,t[e]);return n}async function v(e,t,n){let{pathComponents:r}=R(t);if(!await u(e.root.handle,"readwrite"))throw Error("Permission denied");let i=await h(e.root.handle,r),a=r[r.length-1];try{let t={handle:await i.getFileHandle(a,{create:!0}),path:"".concat(e.root.name,"/").concat(r.join("/")),lastModified:Date.now()};return await p(t,n),e.root.descendants.push(t),!0}catch(e){throw Error("Failed to create file ".concat(t," - ").concat(e))}}async function g(e,t){let{pathComponents:n}=R(t);if(!await u(e.root.handle,"readwrite"))throw Error("Permission denied to delete file in the directory");let r=await h(e.root.handle,n),i=n[n.length-1];try{return await r.removeEntry(i),e.root.descendants=e.root.descendants.filter(t=>t.path!=="".concat(e.root.name,"/").concat(n.join("/"))),!0}catch(e){throw Error("Failed to delete file ".concat(i))}}async function y(e){return(await Promise.all(e.map(w))).flat()}async function w(e){try{if(await u(e.root.handle,"read")){let t=await T(e);t&&(e.root=t.updatedDirectoryRoot)}}catch(t){i.v("Harmony: Could not resync ".concat(e.uuid),t)}let t=e.root.descendants.map(t=>({uri:S(e,t)}));return t.unshift({uri:_(e),mimeType:l}),t}function E(e){return e.mimeType===l}function C(e){return!E(e)}function U(e,t,n){let r=e.find(e=>e.projectUuid===t&&e.uuid===n);if(!r)throw Error("Resource not found: ".concat(t,"/").concat(n));return r}function b(e,t){let{projectUuid:n,directoryUuid:r,pathComponents:i}=P(t),a=U(e,n,r);try{let e=function(e,t){let n="".concat(e.root.name,"/").concat(t.join("/")),r=e.root.descendants.find(e=>e.path===n);if(!r)throw Error("File not found: ".concat(n));return r}(a,i);return{directory:a,file:e}}catch(e){return{directory:a,file:null}}}function S(e,t){let n=t.path.split("/").map(encodeURIComponent);return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/")+n.join("/")}function _(e){return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/").concat(encodeURIComponent(e.root.name),"/")}async function I(e,t,n){let r=[];for await(let i of e.values()){if(i.name.startsWith("."))continue;let e="".concat(t,"/").concat(i.name);if(!n.some(t=>(0,a.s7)(e,t,{matchBase:!0}))){if("file"===i.kind){let e=await d(i,t);r.push(e)}else{let t=await I(i,e,n);r.push(...t)}}}return r}async function x(e,t){return{handle:e,name:e.name,descendants:await I(e,e.name,t)}}async function T(e){let t;let n=e.root;try{t=await x(e.root.handle,e.ignorePatterns)}catch(e){return null}let r=j(n.descendants),i=j(t.descendants),a=[];for(let[e,t]of r.entries()){let n=i.get(e);if(void 0===n){a.push({type:"removed",file:t});continue}n.lastModified!==t.lastModified&&a.push({type:"modified",file:n}),i.delete(e)}for(let e of i.values())a.push({type:"added",file:e});return{updatedDirectoryRoot:t,fileChanges:a}}function j(e){let t=new Map;for(let n of e)t.set(n.path,n);return t}let D=new Map,A=(e,t)=>{D.size>=1e3&&Array.from(D.keys()).slice(0,Math.floor(200)).forEach(e=>D.delete(e)),D.set(e,t)};function P(e){if(D.has(e))return D.get(e);if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');try{let t=new URL(e),n=t.host,[r,i,a,...o]=t.pathname.split("/").map(decodeURIComponent);if(!n||!i||!a)throw Error("Invalid URI: Missing required components");let c={projectUuid:n,directoryUuid:i,directoryName:a,pathComponents:o};return A(e,c),c}catch(e){throw Error("Invalid URI: ".concat(e.message))}}function z(e){try{return P(e),!0}catch(e){return!1}}function R(e){if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');try{let t=new URL(e),n=t.host,[r,i,a,...o]=t.pathname.split("/").map(decodeURIComponent);if(!n||!i||!a)throw Error("Invalid URI: Missing required components");return{projectUuid:n,directoryUuid:i,directoryName:a,pathComponents:o}}catch(e){throw Error("Invalid URI: ".concat(e.message))}}},49456:function(e,t,n){n.d(t,{CL:function(){return j},Jw:function(){return I},MR:function(){return g},Wr:function(){return b},dF:function(){return x},eh:function(){return D},mD:function(){return C},tB:function(){return y},wI:function(){return l}});var r=n(88075),i=n(17299),a=n(44846),o=n(42443);let c=[".DS_Store"],u=["jpg","jpeg","png","gif","webp"],s=["image/jpeg","image/png","image/gif","image/webp"],l={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp"},d=["bmp","ico","tiff","tif","psd","raw","cr2","nef","orf","sr2","mobi","jp2","jpx","jpm","mj2","svg","svgz","ai","eps","ps","indd","heic","mp4","mov","avi","mkv","wmv","flv","webm","mpeg","mpg","m4v","3gp","ogv","ogg","rm","rmvb","asf","amv","mpe","m1v","m2v","svi","3g2","roq","nsv","f4v","f4p","f4a","f4b","qt","hdmov","divx","div","m2ts","mts","vob","mp3","wav","wma","aac","flac","alac","aiff","ogg","opus","m4a","amr","awb","wmv","ra","rm","mid","midi","mka","ttf","otf","woff","woff2","eot","sfnt","ttc","suit","zip"],f=["xls","xlsx","xlsb","xlm","xlsm","xlt","xltm","xltx","ods"],p=["txt","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","scala","rs","dart","lua","pl","pm","t","sh","bash","zsh","csv","log","ini","cfg","config","json","proto","yaml","yml","toml","lua","sql","bat","md","coffee","tex","latex","gd","gdshader","tres","tscn"],m=["docx","rtf","epub","html","odt","odp","pdf"],h=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/epub+zip","text/html","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation","application/pdf"],v=["csv"],g=3e7,y=e=>{let{imagesEnabled:t=!1}=e;return[".pdf",".doc",".docx",".rtf",".epub",".odt",".odp",".pptx",...E(),...t?w():[]]},w=()=>u.map(e=>".".concat(e)),E=()=>p.map(e=>".".concat(e)),C=e=>e.split(".").pop().toLowerCase(),U=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:r=!1}=t,i=C(e.name);return!!(!n&&(u.includes(i)||s.includes(e.type)))||(r?d.includes(i):[...d,...f].includes(i))},b=e=>{let t=C(e.name);return u.includes(t)||s.includes(e.type)},S=e=>[...v,...f].includes(C(e.name)),_=e=>!!c.includes(e.name),I=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:r=!1,rasterizePdfUploadsEnabled:i}=t,a=[],o=[],c=[],u=[],s=[],l=[];return e.filter(e=>!_(e)).forEach(e=>{let t=n&&b(e);U(e,{imagesEnabled:n,blobFileUploadsEnabled:r})?s.push(e):e.size>g?l.push(e):r&&S(e)?c.push(e):i&&("pdf"===C(e.name)||"application/pdf"===e.type)?u.push(e):x(e)?a.push(e):t?o.push(e):a.push(e)}),{attachmentUploads:a,imageUploads:o,rasterizedDocumentUploads:u,unsupportedUploads:s,tooLargeUploads:l,outOfContextFileUploads:c}},x=e=>{let t=C(e.name);return m.includes(t)||h.includes(e.type)},T=e=>{let t=new Uint8Array(e);if(t.length>=4){if(239===t[0]&&187===t[1]&&191===t[2])return"utf-8";if(254===t[0]&&255===t[1]||255===t[0]&&254===t[1])return"utf-16";if(0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]||255===t[0]&&254===t[1]&&0===t[2]&&0===t[3])return"utf-32"}let n=!0,r=Math.min(t.length-1,1e3);for(let e=0;e<r;e+=2)if(0===t[e]&&0===t[e+1]||0!==t[e]&&0!==t[e+1]){n=!1;break}if(n)return"utf-16";let i=!0,a=!1;for(let e=0;e<t.length;e++){let n=t[e];if(n>127){if(a=!0,(224&n)==192){if(e+1>=t.length||(192&t[e+1])!=128){i=!1;break}e+=1}else if((240&n)==224){if(e+2>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128){i=!1;break}e+=2}else if((248&n)==240){if(e+3>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128||(192&t[e+3])!=128){i=!1;break}e+=3}else{i=!1;break}}}if(i&&a)return"utf-8";let o=(e=>{let t={ascii:0,nonAscii:0,cyrillic:0,latin1:0,control:0,total:Math.min(e.length,4e3)};for(let n=0;n<t.total;n++){let r=e[n];r<32?t.control++:r<127?t.ascii++:r>127&&(t.nonAscii++,(r>=192&&r<=255||r>=168&&r<=183)&&t.cyrillic++,(r>=128&&r<=159||r>=160&&r<=255)&&t.latin1++)}return t})(t),c=o.cyrillic/o.total*100,u=o.latin1/o.total*100,s=o.ascii/o.total*100;if(o.nonAscii>0){if(c>.3)return"windows-1251";if(u>o.control/o.total*100)return"windows-1252"}return s>90&&o.control/o.total<.1?"ascii":"utf-8"},j=async e=>{let t=await e.arrayBuffer(),n=T(t);try{return new TextDecoder(n,{fatal:!0}).decode(t)}catch(e){if("utf-8"!==n)return new TextDecoder("utf-8",{fatal:!0}).decode(t)}throw Error("Failed to decode file as plain text")};function D(){let{value:e}=(0,a.F)("ooc_attachments"),{account:t}=(0,r.t)(),n=(0,i.T)(),c=(0,o.h)();return!!e&&(!!c||!!n&&!!n.enabled_artifacts_attachments||!!(t&&t.settings.enabled_artifacts_attachments))}},42443:function(e,t,n){n.d(t,{Z:function(){return i},h:function(){return a}});var r=n(48644);function i(){let{layer:e}=(0,r.useLayer)("frontend");return e.get("analysis_tool_experiment_enabled",!1)}function a(e){let t=i();return(null==e?void 0:e.enabled_artifacts_attachments)||t}},32751:function(e,t,n){function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}n.d(t,{f:function(){return r},v:function(){return i}})}}]);