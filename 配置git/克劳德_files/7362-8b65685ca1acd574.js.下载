"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7362],{57362:function(e,n,i){i.d(n,{Bo:function(){return U},Bt:function(){return Q},KN:function(){return y},MH:function(){return z},Nt:function(){return E},QO:function(){return K},QU:function(){return g},Qw:function(){return _},Ux:function(){return m},Xg:function(){return b},Y:function(){return C},bN:function(){return p},fq:function(){return I},is:function(){return w},kK:function(){return T},kS:function(){return D},oy:function(){return M},pV:function(){return h},vF:function(){return P},xt:function(){return k}});var t=i(89992),a=i(88075),u=i(24658),r=i(94673),l=i(67174),o=i(65490),s=i(49793),c=i(73571),d=i(83056),v=i(7653),f=i(39617);function m(e){let{onError:n}=e,{activeOrganization:i}=(0,a.t)(),{data:u,variables:r,...l}=(0,t.uC)("/api/billing/".concat(null==i?void 0:i.uuid,"/consumer_pricing"),"POST",{enabled:!!i,meta:{noToast:!0},onError:n}),[o,s]=(0,v.useState)(),[c,d]=(0,v.useState)();return(0,v.useEffect)(()=>{u&&(s(u),d(r))},[u,r]),{data:o,variables:c,...l}}function g(e){let{onError:n}=e,{activeOrganization:i}=(0,a.t)(),{data:u,variables:r,...l}=(0,t.uC)("/api/billing/".concat(null==i?void 0:i.uuid,"/cw_pricing"),"POST",{enabled:!!i,meta:{noToast:!0},onError:n}),[o,s]=(0,v.useState)(),[c,d]=(0,v.useState)();return(0,v.useEffect)(()=>{u&&(s(u),d(r))},[u,r]),{data:o,variables:c,...l}}let y=()=>{let{activeOrganization:e}=(0,a.t)();return(0,t.uC)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription"),"PUT",{enabled:!!e})},p=()=>{let{activeOrganization:e}=(0,a.t)();return(0,t.uC)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription/cw"),"PUT",{enabled:!!e})};function b(){let{activeOrganization:e}=(0,a.t)();return(0,t.WE)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription_details"),{queryKey:[s.QU,null==e?void 0:e.uuid],staleTime:0,enabled:!!e,meta:{noToast:e=>e instanceof o.Hx&&404===e.statusCode}})}let Q=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{addError:t}=(0,u.e)(),a=(0,d.useQueryClient)(),r=(0,l.Iw)(e,{...i,async onSuccess(u,l,o){var c;if("payment_intent_client_secret"in u){let e=await n;if(!e){t("Stripe failed to initialize. Please try again.");return}if((await e.confirmPayment({clientSecret:u.payment_intent_client_secret,redirect:"if_required"})).error){t("Payment confirmation failed. Please try again.");return}r.mutate(l);return}a.invalidateQueries([s.je,e]),a.invalidateQueries([s.sM,e]),await (null===(c=i.onSuccess)||void 0===c?void 0:c.call(i,u,l,o))}});return r},_=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{addError:t}=(0,u.e)(),a=(0,d.useQueryClient)(),r=(0,l.Qx)(e,{...i,async onSuccess(u,l,o){var c;if("payment_intent_client_secret"in u){let e=await n;if(!e){t("Stripe failed to initialize. Please try again.");return}if((await e.confirmPayment({clientSecret:u.payment_intent_client_secret,redirect:"if_required"})).error){t("Payment confirmation failed. Please try again.");return}r.mutate(l);return}a.invalidateQueries([s.je,e]),a.invalidateQueries([s.sM,e]),await (null===(c=i.onSuccess)||void 0===c?void 0:c.call(i,u,l,o))}});return r};function S(){let{activeOrganization:e}=(0,a.t)(),n=(0,a.Cf)();return(0,t.WE)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription_status"),{queryKey:[s.sM,null==e?void 0:e.uuid],staleTime:0,enabled:!!e&&n,meta:{noToast:e=>e instanceof o.Hx&&404===e.statusCode}})}function h(){let{data:e,isLoading:n}=S();return{isRavenCanceled:(null==e?void 0:e.status)==="canceled"||(null==e?void 0:e.status)==="unpaid",isLoading:n}}function w(){let{data:e,isLoading:n}=S();return{isRavenPastDue:(null==e?void 0:e.status)==="past_due",isLoading:n}}function C(){let{data:e,isLoading:n}=S();return{isRavenPendingCancellation:!!(null==e?void 0:e.cancel_at_ts),isLoading:n}}function T(){let{activeOrganization:e}=(0,a.t)(),{isRavenCanceled:n,isLoading:i}=h(),{isRavenPastDue:t,isLoading:u}=w(),r=i||u,l=(null==e?void 0:e.billing_type)==="stripe_subscription_contracted";return{isLoading:r,canManageMembers:!r&&!n&&(l||!t)}}function U(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,a.t)(),i=(0,d.useQueryClient)(),u=null==n?void 0:n.uuid;return(0,t.uC)("/api/organizations/".concat(u,"/end_subscription"),"PUT",{...e,onSuccess(n,t,a){var r;i.setQueryData([s.QU,u],e=>{if(e)return{...e,plan_ending_before:"".concat(n.plan_ends_at,"T00:00:00+00:00")}}),i.invalidateQueries([s.sM,u]),i.invalidateQueries([s.je,u]),null===(r=e.onSuccess)||void 0===r||r.call(e,n,t,a)},enabled:!!n})}function M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,a.t)(),i=(0,d.useQueryClient)(),u=null==n?void 0:n.uuid;return(0,t.uC)("/api/organizations/".concat(u,"/resume_subscription"),"PUT",{...e,onSuccess(n,t,a){var r;i.setQueryData([s.QU,u],e=>{if(e)return{...e,plan_ending_before:null}}),i.invalidateQueries([s.sM,u]),i.invalidateQueries([s.je,u]),null===(r=e.onSuccess)||void 0===r||r.call(e,n,t,a)},enabled:!!n})}function P(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,a.t)(),i=(0,d.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(null==n?void 0:n.uuid,"/renew_subscription/cw"),"PUT",{...e,onSuccess(t,a,u){var r;i.invalidateQueries([s.QU,null==n?void 0:n.uuid]),i.invalidateQueries([s.sM,null==n?void 0:n.uuid]),i.invalidateQueries([s.RK,null==n?void 0:n.uuid]),i.invalidateQueries([s.je,null==n?void 0:n.uuid]),null===(r=e.onSuccess)||void 0===r||r.call(e,t,a,u)},enabled:!!n})}function z(e){let{limit:n,createdSince:i,organizationUUID:u,meta:r}=e,{activeOrganization:l}=(0,a.t)(),o=Math.round(i.toSeconds()),c=u||(null==l?void 0:l.uuid);return(0,t.WE)("/api/stripe/".concat(c,"/invoices?limit=").concat(n,"&created_since_ts=").concat(o),{queryKey:[s.RK,c,{limit:n,created_since_ts:o}],staleTime:0,enabled:!!c,meta:r})}function E(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,a.t)(),i=(0,a.Cf)();return(0,t.WE)("/api/stripe/".concat(null==n?void 0:n.uuid,"/upcoming_invoice"),{queryKey:[s.je,null==n?void 0:n.uuid],staleTime:0,enabled:!!n&&i,meta:{noToast:e=>e instanceof o.Hx&&500===e.statusCode},...e})}function D(){let{activeOrganization:e}=(0,a.t)(),n=(0,d.useQueryClient)(),i=null==e?void 0:e.uuid;return(0,t.uC)("/api/organizations/".concat(i,"/payment_method/update_latest"),"POST",{onSuccess:async e=>{let t=n.getQueryData([s.QU,i]);t&&e?n.setQueryData([s.QU,i],{...t,payment_method:{...e}}):await n.invalidateQueries([s.QU,i]),n.invalidateQueries([s.sM,i]),n.invalidateQueries([s.RK,i])},meta:{noToast:!0}})}function K(){let{data:e,isLoading:n}=(0,l.uy)(),{data:i,isLoading:t}=(0,l.cK)(),u=(0,r.N)(c.YB.MembersManage),{data:o}=(0,f.aJ)(),s=(0,a.gQ)(),d=n||t||!e||!i||!o;if(d)return{isLoading:d,hasManageMembersPermission:u,membersWithMinApplied:!1,activeMembers:0,invitedMembers:0,unclaimedMembers:0,minimumApplied:!1,memberLimit:0,isUnlimited:!1};let v=e.length,m=i.filter(e=>"pending"===e.status).length,g=v+m,y=s?o.members_limit-g:Math.max(5-g,0);return{isLoading:d,hasManageMembersPermission:u,totalMembersWithoutMinimumApplied:g,totalMembersWithMinimumApplied:Math.max(v+m,5),activeMembers:v,invitedMembers:m,unclaimedMembers:y,minimumApplied:g<5,memberLimit:o.members_limit,isUnlimited:o.unlimited_members||!1}}function I(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:i}=(0,a.t)(),u="/api/organizations/".concat(null!==(e=null==i?void 0:i.uuid)&&void 0!==e?e:"","/profile"),r=(0,d.useQueryClient)();return(0,t.uC)(u,"PUT",{...n,async onSuccess(){for(var e,i=arguments.length,t=Array(i),a=0;a<i;a++)t[a]=arguments[a];await r.invalidateQueries([s.eo]),await (null===(e=n.onSuccess)||void 0===e?void 0:e.call(n,...t))}})}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,a.t)(),i=(0,d.useQueryClient)(),u=null==n?void 0:n.uuid;return(0,t.uC)("/api/organizations/".concat(u,"/pro/upgrade_to_yearly"),"PUT",{...e,onSuccess(n,t,a){var r;i.invalidateQueries([s.QU,u]),i.invalidateQueries([s.sM,u]),i.invalidateQueries([s.je,u]),i.invalidateQueries([s.RK,u]),null===(r=e.onSuccess)||void 0===r||r.call(e,n,t,a)},enabled:!!n})}},39617:function(e,n,i){i.d(n,{$f:function(){return d},$r:function(){return l},CQ:function(){return o},KJ:function(){return c},aJ:function(){return s}});var t=i(89992),a=i(88075),u=i(49793),r=i(83056);let l=e=>(0,t.WE)("/api/organizations/".concat(e),{queryKey:[u.mm,e],enabled:!!e,staleTime:3e4}),o=()=>{let{activeOrganization:e}=(0,a.t)(),n=null==e?void 0:e.uuid;return(0,t.Ne)(e=>{let{flagType:i}=e;return"/api/organizations/".concat(n,"/flags/").concat(i,"/dismiss")},"POST",(e,n)=>{let{flagType:i}=e;if(n)return{...n,active_flags:n.active_flags.filter(e=>e.type!==i)}},{queryKey:[u.mm,n]})},s=()=>{let{activeOrganization:e}=(0,a.t)(),n=null==e?void 0:e.uuid;return(0,t.WE)("/api/organizations/".concat(n,"/members_limit"),{queryKey:[u.UD,n],enabled:!!n,staleTime:0})},c=()=>{let{activeOrganization:e}=(0,a.t)(),n=null==e?void 0:e.uuid;return(0,t.WE)("/api/organizations/".concat(n,"/public_projects_enabled"),{queryKey:[u.eu,n],enabled:!!n,staleTime:0})};function d(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:i}=(0,a.t)(),l="/api/organizations/".concat(null!==(e=null==i?void 0:i.uuid)&&void 0!==e?e:""),o=(0,r.useQueryClient)();return(0,t.uC)(l,"PUT",{enabled:!!i,...n,async onSuccess(){for(var e,i=arguments.length,t=Array(i),a=0;a<i;a++)t[a]=arguments[a];await Promise.all([o.invalidateQueries([u.aY]),o.invalidateQueries([u.mm])]),await (null===(e=n.onSuccess)||void 0===e?void 0:e.call(n,...t))}})}},24658:function(e,n,i){i.d(n,{ErrorsProvider:function(){return p},e:function(){return b},v:function(){return Q}});var t=i(27573),a=i(62627),u=i(20579),r=i.n(u),l=i(93749),o=i.n(l),s=i(63844),c=i.n(s),d=i(67754),v=i(7653),f=i(48644),m=i(88075),g=i(20504);let y=(0,v.createContext)(void 0);function p(e){let{children:n}=e,i=(0,v.useRef)(1),[a,u]=(0,v.useState)([]),r=(0,v.useCallback)(e=>{u(n=>n.filter(n=>n.id!==e))},[]),l=(0,v.useCallback)((e,n)=>{let t=i.current++;return u(n=>[...n,{id:t,message:e instanceof Error?e.message:e,toastType:"error"}]),n&&setTimeout(()=>r(t),n),t},[r]),o=(0,v.useCallback)((e,n)=>{let t=i.current++;return u(n=>[...n,{id:t,message:e,toastType:"success"}]),n&&setTimeout(()=>r(t),n),t},[r]),s=(0,v.useMemo)(()=>({toasts:a,addError:l,addSuccess:o,clearToast:r}),[a,l,o,r]);return(0,t.jsx)(y.Provider,{value:s,children:n})}function b(){let e=(0,v.useContext)(y);if(!e)throw Error("Must be called within ErrorsProvider");return e}function Q(){var e;let{config:n}=(0,f.useConfig)("claude_system_message"),i=n.get("id",null),t=n.get("title",null),u=n.get("message",null),l=n.get("displayFrequencyHours",null),{account:s}=(0,m.t)(),y=null!==(e=null==s?void 0:s.uuid)&&void 0!==e?e:"logged-out",p=(0,d.usePathname)(),[b,Q]=(0,g.Rr)("dismissed-system-messages",{}),_=(0,v.useMemo)(()=>()=>Q(e=>{let n=r()(e);return i&&c()(n,[y,i],Date.now()),n}),[Q,y,i]);return(0,v.useMemo)(()=>{if(!s||(0,a.cG)(s,!0)||"/download"===p||!i)return!1;let e=o()(b,[y,i]);return!e||"boolean"==typeof e||!!l&&Date.now()-e>=36e5*l},[s,i,y,b,l,p])?{currentSystemMessageId:i,currentSystemMessageTitle:t,currentSystemMessageContent:u,dismissCurrentSystemMessage:_}:{currentSystemMessageId:null,currentSystemMessageTitle:null,currentSystemMessageContent:null,dismissCurrentSystemMessage:()=>null}}},94673:function(e,n,i){i.d(n,{N:function(){return r}});var t=i(73571),a=i(7653),u=i(88075);function r(e){let{account:n,activeOrganization:i}=(0,u.t)();return(0,a.useMemo)(()=>(0,t.Di)(n,i,e),[n,i,e])}},20504:function(e,n,i){i.d(n,{Aq:function(){return s},Rr:function(){return o}});var t=i(94029),a=i.n(t),u=i(7653);let r=(e,n)=>e===window.localStorage?"LSS-".concat(n):"SSS-".concat(n);function l(e,n,i){let t=(0,u.useCallback)(()=>{if(null===e)return i;try{let t=e.getItem(r(e,n));return t?JSON.parse(t):i}catch(e){return console.log(e),i}},[e,n,i]),[l,o]=(0,u.useState)(t),s=(0,u.useCallback)(()=>{o(t())},[t]),c=(0,u.useRef)(a()(t=>{if(null!==e)try{if(JSON.stringify(t)===JSON.stringify(i)){e.removeItem(r(e,n));return}e.setItem(r(e,n),JSON.stringify(t))}catch(e){console.log(e)}},250)),d=(0,u.useCallback)(()=>{o(i),setTimeout(()=>{null!==e&&(c.current.cancel(),e.removeItem(r(e,n)))},0)},[o,i,e,n]);return(0,u.useEffect)(()=>{c.current(l)},[l]),[l,o,d,s]}function o(e,n){return l(window.localStorage,e,n)}function s(e,n){return l(window.sessionStorage,e,n)}},67174:function(e,n,i){i.d(n,{DT:function(){return f},Iw:function(){return m},Qx:function(){return g},cK:function(){return d},er:function(){return v},gK:function(){return c},uy:function(){return s},wA:function(){return y}});var t=i(89992),a=i(88075),u=i(24658),r=i(65490),l=i(49793),o=i(83056);let s=()=>{var e;let{activeOrganization:n}=(0,a.t)();return(0,t.WE)("/api/organizations/".concat(null!==(e=null==n?void 0:n.uuid)&&void 0!==e?e:"","/members"),{enabled:!!(null==n?void 0:n.uuid)&&(n.capabilities.includes("api")||n.capabilities.includes("raven")),queryKey:[l.I_,{orgUUID:null==n?void 0:n.uuid}],staleTime:0})},c=function(e){var n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:u}=(0,a.t)(),r=(0,o.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(null!==(n=null==u?void 0:u.uuid)&&void 0!==n?n:"","/members/").concat(e),"PUT",{...i,meta:{errorMessage:"There was an error updating the user’s role."},async onSuccess(){for(var e,n=arguments.length,t=Array(n),a=0;a<n;a++)t[a]=arguments[a];await Promise.all([r.invalidateQueries([l.I_,{orgUUID:null==u?void 0:u.uuid}]),r.invalidateQueries([l.BB,{orgUUID:null==u?void 0:u.uuid}])]),await (null===(e=i.onSuccess)||void 0===e?void 0:e.call(i,...t))}})},d=()=>{var e;let{activeOrganization:n}=(0,a.t)();return(0,t.WE)("/api/organizations/".concat(null!==(e=null==n?void 0:n.uuid)&&void 0!==e?e:"","/invites"),{enabled:!!(null==n?void 0:n.uuid)&&(n.capabilities.includes("api")||n.capabilities.includes("raven")),queryKey:[l.BB,{orgUUID:null==n?void 0:n.uuid}],staleTime:0})},v=function(e,n,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=(0,o.useQueryClient)(),{addError:c}=(0,u.e)(),d="uuid"in n?n.uuid:n.account.uuid,v="email_address"in n?n.email_address:n.account.email_address;return(0,t.uC)("/api/organizations/".concat(e,"/").concat(i?"workspaces/".concat(i,"/"):"","members/").concat(d),"DELETE",{...a,meta:{noToast:!0},async onSuccess(){for(var n,t=arguments.length,u=Array(t),r=0;r<t;r++)u[r]=arguments[r];i?await s.invalidateQueries([l.Nw,{orgUUID:e,workspaceId:i}]):(await s.invalidateQueries([l.I_,{orgUUID:e}]),s.invalidateQueries([l.je,e]),s.invalidateQueries([l.sM,e])),await (null===(n=a.onSuccess)||void 0===n?void 0:n.call(a,...u))},onError(e){var n,i;e instanceof r.Hx&&(null===(i=e.extra)||void 0===i?void 0:null===(n=i.details)||void 0===n?void 0:n.type)==="seat_minimum_reached"?c("You cannot go below 5 members."):c("There was an error removing ".concat(v," from the organization."))}})},f=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=(0,o.useQueryClient)(),{addError:s}=(0,u.e)();return(0,t.uC)("/api/organizations/".concat(e,"/invites/").concat(n),"DELETE",{...i,meta:{noToast:!0},async onSuccess(){for(var n,t=arguments.length,u=Array(t),r=0;r<t;r++)u[r]=arguments[r];await a.invalidateQueries([l.BB,{orgUUID:e}]),a.invalidateQueries([l.je,e]),a.invalidateQueries([l.sM,e]),await (null===(n=i.onSuccess)||void 0===n?void 0:n.call(i,...u))},onError(e){var n,i;e instanceof r.Hx&&(null===(i=e.extra)||void 0===i?void 0:null===(n=i.details)||void 0===n?void 0:n.type)==="seat_minimum_reached"?s("You cannot go below 5 members."):s("There was an error revoking the invite.")}})},m=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,o.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(e,"/invites"),"POST",{...n,async onSuccess(){for(var t,a=arguments.length,u=Array(a),r=0;r<a;r++)u[r]=arguments[r];await i.invalidateQueries([l.BB,{orgUUID:e}]),i.invalidateQueries([l.je,e]),i.invalidateQueries([l.sM,e]),await (null===(t=n.onSuccess)||void 0===t?void 0:t.call(n,...u))}})},g=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,o.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(e,"/invites/bulk"),"POST",{...n,async onSuccess(){for(var t,a=arguments.length,u=Array(a),r=0;r<a;r++)u[r]=arguments[r];await i.invalidateQueries([l.BB,{orgUUID:e}]),i.invalidateQueries([l.je,e]),i.invalidateQueries([l.sM,e]),await (null===(t=n.onSuccess)||void 0===t?void 0:t.call(n,...u))}})},y=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=(0,o.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(e,"/invites/").concat(n),"PUT",{...i,async onSuccess(){for(var n,t=arguments.length,u=Array(t),r=0;r<t;r++)u[r]=arguments[r];await a.invalidateQueries([l.BB,{orgUUID:e}]),await (null===(n=i.onSuccess)||void 0===n?void 0:n.call(i,...u))}})}},62627:function(e,n,i){i.d(n,{D_:function(){return r},c6:function(){return a},cG:function(){return l},kK:function(){return u},wJ:function(){return t}});let t=e=>{let{account:n,isClaudeDot:i}=e,t=!1===n.settings.has_finished_claudeai_onboarding;return!n.full_name||!n.display_name||!!i&&t},a=(e,n)=>n&&!e.is_verified,u=(e,n)=>!!function(e,n){for(let i of e.invites)if(i.organization.capabilities&&i.organization.capabilities.includes(n))return i}(e,n?"raven":"api"),r=(e,n)=>!n&&0===e.invites.length&&0===e.memberships.filter(e=>e.organization.capabilities.includes("api")).length,l=(e,n)=>t({account:e,isClaudeDot:n})||a(e,n)||u(e,n)||r(e,n)}}]);