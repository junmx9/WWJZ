"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2379],{61867:function(e,t,n){n.d(t,{KX:function(){return h},O3:function(){return b},P2:function(){return f},TD:function(){return x},q2:function(){return y},to:function(){return o},vr:function(){return m}});var r,o,s=n(15489),a=n(97712),i=n(3286);(r=o||(o={})).ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",r.SetContent="anthropic.claude.usercontent.sandbox.SetContent",r.GetFile="anthropic.claude.usercontent.sandbox.GetFile",r.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",r.RunCode="anthropic.claude.usercontent.sandbox.RunCode",r.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",r.ReportError="anthropic.claude.usercontent.sandbox.ReportError";let c=a.z.object({type:a.z.literal("UnsupportedImports"),unsupportedModules:a.z.array(a.z.string()),nonExistentIcons:a.z.array(a.z.string())}),u=a.z.object({type:a.z.literal("RuntimeError"),message:a.z.string()}),l=a.z.object({type:a.z.literal("FileNotFound"),fileName:a.z.string()}),d=a.z.object({type:a.z.literal("ClaudeCompletionError"),message:a.z.string()}),p=a.z.discriminatedUnion("type",[c,u,l,d]),h=a.z.object({code:a.z.string()}),m=a.z.object({status:a.z.enum(["success","error"]),result:a.z.string().optional(),logs:a.z.array(a.z.string()),error:a.z.string().optional()}),g={"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:a.z.strictObject({"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),a.z.literal("anthropic.claude.usercontent.sandbox.SandboxContent")]),content:a.z.string(),type:a.z.nativeEnum(s.JP)})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:a.z.strictObject({"@type":a.z.union([a.z.literal("type.googleapis.com/google.protobuf.Empty"),a.z.literal("google.protobuf.Empty")])})}),responseSchema:i.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:a.z.strictObject({key:a.z.string(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.GetFileRequest")])})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({value:a.z.instanceof(Uint8Array).nullable(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse"),a.z.literal("anthropic.claude.usercontent.sandbox.GetFileResponse")])})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:a.z.strictObject({message:a.z.string(),messageType:a.z.enum(["text","error"]),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")])})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:a.z.strictObject({code:a.z.string(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.RunCodeRequest")])})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse"),a.z.literal("anthropic.claude.usercontent.sandbox.RunCodeResponse")])}).merge(m)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:a.z.strictObject({prompt:a.z.string(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")])})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({completion:a.z.string().nullable(),"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse"),a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")])})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:a.z.strictObject({"@type":a.z.union([a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest"),a.z.literal("anthropic.claude.usercontent.sandbox.ReportErrorRequest")]),error:p})}),responseSchema:i.AY,alwaysPermitted:!0}},f=a.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError"]),y=a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,g["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema]);a.z.union([i.AY,g["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema]),a.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode"]),a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema]);let b=a.z.union([g["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema]),x=Object.entries(g).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},3286:function(e,t,n){n.d(t,{AY:function(){return c},D7:function(){return u},Kj:function(){return i},Tk:function(){return a},Zq:function(){return s},qV:function(){return o},v8:function(){return l}});var r=n(97712);let o=r.z.object({channel:r.z.enum(["request","response"]),requestId:r.z.string()}).passthrough(),s=o.strict().extend({channel:r.z.literal("request"),method:r.z.string(),payload:r.z.strictObject({"@type":r.z.string()})}),a=o.extend({channel:r.z.literal("response"),status:r.z.number().int().min(100).max(599),payload:r.z.strictObject({"@type":r.z.string()}).passthrough()}).passthrough(),i=a.extend({status:r.z.number().int().min(400).max(599),payload:r.z.strictObject({"@type":r.z.union([r.z.literal("anthropic.claude.usercontent.ErrorResponse"),r.z.literal("type.googleapis.com/anthropic.claude.usercontent.ErrorResponse")]),error:r.z.string()})}),c=a.extend({payload:r.z.strictObject({"@type":r.z.union([r.z.literal("google.protobuf.Empty"),r.z.literal("type.googleapis.com/google.protobuf.Empty")])})}),u={"@type":"type.googleapis.com/google.protobuf.Empty"},l=e=>({"@type":"type.googleapis.com/anthropic.claude.usercontent.ErrorResponse",error:e})},92829:function(e,t,n){n.d(t,{I:function(){return i}});var r=n(7653),o=n(61867),s=n(3286);class a{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=s.qV.safeParse(e.data);if(!n.success){console.warn("Received message does not conform to basic message shape, ignoring");return}let r=n.data;if("response"===r.channel){this.handleResponse(r);return}this.messageQueue.push(r),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId);if(void 0!==t){t(e);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=o.P2.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,r=o.q2.safeParse(e);if(!r.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let a=r.data;if(this.requestLog.has(a.requestId)){this.sendErrorResponse(a.requestId,400,"Request ID already processed");continue}this.requestLog.set(a.requestId,{message:a,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(a.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(a,this.boundSendRequest).then(e=>{var t;let n=s.Tk.parse({channel:"response",status:200,requestId:a.requestId,payload:null!=e?e:s.D7}),r=this.requestLog.get(a.requestId);r&&this.requestLog.set(a.requestId,{...r,response:n,responseTimestamp:new Date().getTime()}),null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var r;let o=s.Kj.parse({channel:"response",status:t,requestId:e,payload:(0,s.v8)(n)}),a=this.requestLog.get(e);a&&this.requestLog.set(e,{...a,response:o,responseTimestamp:new Date().getTime()}),null===(r=this.iframe.contentWindow)||void 0===r||r.postMessage(o,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener(),
this.allowedOrigin=window.location.origin}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t){return new Promise((n,r)=>{var a;let i=Date.now().toString();this.inFlightRequests.set(i,e=>{let t=s.Tk.safeParse(e);if(!t.success){r(Error("Invalid response format"));return}let a=t.data;if(a.status>=400){let e=s.Kj.safeParse(a);e.success?r(Error(e.data.payload.error)):r(Error("Error response (".concat(a.status,")")));return}let i=o.O3.safeParse(a);i.success?n(i.data.payload):r(Error("Invalid response payload for the method"))}),null===(a=this.iframe.contentWindow)||void 0===a||a.postMessage({channel:"request",method:e,requestId:i,payload:t},this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:r,onCapabilityAction:o}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=r,this.onCapabilityAction=o,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener(),
this.allowedOrigin=window.location.origin}}function i(e){let{iframeRef:t,allowedOrigin:n,onRateLimited:s=null,initialPermissions:i,onPermissionRequested:c,onCapabilityAction:u}=e,[l,d]=(0,r.useState)(null),p=(0,r.useRef)(i);(0,r.useEffect)(()=>{if(t.current){let e=new a({iframe:t.current,allowedOrigin:n,onRateLimited:s,onPermissionRequested:async e=>{if(o.TD.includes(e)||"accepted"===p.current[e])return"accepted";let t=await c(e);return p.current={...p.current,[e]:t},t},onCapabilityAction:u});return d(e),()=>{e.cleanup()}}},[t,n,p,s,c,u]);let h=(0,r.useCallback)(async(e,t)=>{if(l)return l.sendRequest(e,t);throw Error("Communicator not initialized")},[l]),m=(0,r.useCallback)(()=>{null==l||l.restartListening()},[l]),g=(0,r.useCallback)((e,t)=>{p.current={...p.current,[e]:t}},[]);return{sendRequest:null===l?void 0:h,restartListening:m,permissions:p.current,updatePermission:g}}},2190:function(e,t,n){n.d(t,{E:function(){return s},N:function(){return a}});var r=n(24550);function o(e,t){let n=new Map;return t.forEach(e=>{var t;let r=null!==(t=n.get(e.file_name))&&void 0!==t?t:[];r.push(e),n.set(e.file_name,r)}),n.get(e)}let s=(e,t)=>{let n=o(e,t);if(!n||0===n.length)return null;let r=n[n.length-1];if(r){let e=r.extracted_content;return new TextEncoder().encode(e)}return null},a=async(e,t,n)=>{let s=o(e,t);if(!s||0===s.length)return null;let a=s.filter(e=>e.file_kind===r.Y.Blob);if(0===a.length)return null;let i=a[a.length-1];try{let e=await fetch("/api/organizations/".concat(n,"/files/").concat(i.file_uuid,"/contents"));if(!e.ok)return null;let t=await e.arrayBuffer();if(t.byteLength>2147483648-1)return null;return new Uint8Array(t)}catch(e){return null}}},6482:function(e,t,n){n.d(t,{M:function(){return s},T:function(){return o}});var r=n(7653);let o=(0,r.createContext)(null),s=()=>{let e=(0,r.useContext)(o);if(!e)throw Error("usePersistentSandbox must be used within a PersistentSandboxProvider");return e}},57851:function(e,t,n){n.d(t,{McpProvider:function(){return f},c:function(){return g}});var r=n(27573),o=n(2275),s=n(21468),a=n(24658),i=n(89194),c=n(28294),u=n(7653),l=n(89992),d=n(88075);c.kO.shape.params;var p=n(57012);class h{start(){return this._port.onmessage=e=>{var t;null===(t=this.onmessage)||void 0===t||t.call(this,e.data)},this._port.onmessageerror=e=>{var t;null===(t=this.onerror)||void 0===t||t.call(this,Error("MessagePort message error: ".concat(e.data)))},Promise.resolve()}close(){var e;return this._port.close(),null===(e=this.onclose)||void 0===e||e.call(this),Promise.resolve()}send(e){return this._port.postMessage(e),Promise.resolve()}constructor(e){this._port=e}}let m=(0,u.createContext)({mcpClients:{},mcpTools:[],isLoading:!1,isEnabled:!1}),g=()=>{let e=(0,u.useContext)(m);return e||console.warn("useMcp being used outside of McpProvider, this is probably a bug"),e};function f(e){let{children:t}=e,[n,i]=(0,u.useState)({}),[h,g]=(0,u.useState)(!1),{addError:f}=(0,a.e)(),{tools:b,onDolphinInterrupted:x}=function(e){let{mcpClients:t}=e,[n,r]=(0,u.useState)([]),i=(0,u.useRef)(!1),l=(0,u.useRef)(null),d=(0,u.useRef)(!1),{addError:h}=(0,a.e)(),{track:m}=(0,s.z$)(),g=(0,u.useCallback)(async(e,n,r)=>{if((0,o.Rx)()&&"dolphin"===e){let e=d.current?'Claude would like to run the tool "'.concat(n.name,'" but was previously interrupted. Do you want to allow this?'):'Claude would like to run the tool "'.concat(n.name,'". Do you want to allow this?');if(i.current&&!confirm(e))return m({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(r).length}),d.current=!0,{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],isError:!0};l.current=Date.now(),i.current=!1}try{let o=await t[e].callTool({name:n.name,arguments:r},c.M$,{timeout:6e4});if(m({event_key:"mcp.tools.called",result:"success",argument_count:Object.keys(r).length}),"content"in o)return o;return{content:[{type:"text",text:JSON.stringify(o.toolResult,null,2)}],isError:!1}}catch(e){throw h("Failed to call tool ".concat(n.name,": ").concat(e)),m({event_key:"mcp.tools.called",result:"failure",argument_count:Object.keys(r).length}),e}},[h,t,m]);return(0,u.useEffect)(()=>{let e=!1;return async function(){if(!t)return;let n=await (0,p.k)(t,{method:"tools/list",params:{}},c.Gd);e||r(Object.entries(n).map(e=>{var t;let[n,r]=e;return m({event_key:"mcp.tools.listed",tool_count_on_server:r.tools.length}),null!==(t=r.tools.map(e=>({...e,serverName:n,callback:t=>g(n,e,t)})))&&void 0!==t?t:[]}).flat())}(),()=>{e=!0}},[g,t,m]),{tools:n,onDolphinInterrupted:(0,u.useCallback)(()=>{"number"==typeof l.current&&Date.now()<l.current+100||(i.current=!0)},[l])}}({mcpClients:n}),{track:v}=(0,s.z$)();!function(e){let{mcpClients:t}=e,{addError:n}=(0,a.e)(),{track:r}=(0,s.z$)(),{activeOrganization:o}=(0,d.t)(),i=(0,l.uC)("/api/organizations/".concat(null==o?void 0:o.uuid,"/dust/mcp_messages"),"POST",{enabled:!1,onError:()=>n("MCP sampling failed")});(0,u.useEffect)(()=>{},[!1,t,i,r])}({mcpClients:n});let w=(0,u.useCallback)(e=>{if(e.source!==window)return;let{type:t,serverName:n}=e.data;if("mcp-server-connected"!==t||!n)return;let[r]=e.ports;y(r).then(e=>{console.log("Connected to MCP server ".concat(n)),i(t=>({...null!=t?t:{},[n]:e})),"dolphin"===n&&e.setNotificationHandler(c.b5,e=>{"USER_INTERRUPT"===e.params.data&&x()}),v({event_key:"mcp.servers.connected",result:"success"})},e=>{console.error("Could not attach to MCP server ".concat(n,":"),e),f("Could not attach to MCP server ".concat(n)),v({event_key:"mcp.servers.connected",result:"failure"})})},[f,v,x]);(0,u.useEffect)(()=>{window.addEventListener("message",w);let e=!1;async function t(){var t,n;if(!(null===(t=window.claudeAppBindings)||void 0===t?void 0:t.listMcpServers)||!(null===(n=window.claudeAppBindings)||void 0===n?void 0:n.connectToMcpServer))return;let r=await window.claudeAppBindings.listMcpServers();v({event_key:"mcp.servers.listed",server_count:r.length}),e||await Promise.all(r.map(e=>window.claudeAppBindings.connectToMcpServer(e).catch(t=>{console.error("Could not connect to MCP server ".concat(e,":"),t),f("Could not connect to MCP server ".concat(e))})))}return g(!0),t().finally(()=>g(!1)),()=>{e=!0,window.removeEventListener("message",w)}},[w,f,v]);let z=(0,u.useMemo)(()=>Object.keys(n).length>0,[n]);return(0,r.jsx)(m.Provider,{value:{mcpClients:n,mcpTools:b,isLoading:h,isEnabled:z},children:t})}async function y(e){let t=new h(e),n=new i.K({name:"claude-ai",version:"0.1.0"},{capabilities:{}});return await t.start(),await n.connect(t),n}},57012:function(e,t,n){n.d(t,{k:function(){return o}});var r=n(28294);async function o(e,t,n,o){return e?Object.fromEntries((await Promise.all(Object.entries(e).map(async e=>{let[s,a]=e;try{let e=await a.request(t,n,{timeout:5e3,...o});return[s,e]}catch(e){if(e instanceof r.yp&&e.code===r.jK.MethodNotFound)return null;return console.error("Request ".concat(t.method," to ").concat(s," failed: ").concat(e)),null}}))).filter(e=>null!==e)):{}}},2275:function(e,t,n){n.d(t,{Bc:function(){return u},H9:function(){return d},LT:function(){return o},Rx:function(){return c},eY:function(){return l},hd:function(){return i}});var r,o,s=n(7653),a=n(45355);function i(){var e;c()&&(null===(e=window.claudeAppBindings)||void 0===e?void 0:e.toggleDarkMode)&&window.claudeAppBindings.toggleDarkMode()}function c(){let e=window.navigator.userAgent.toLowerCase();return/(claude.*electron)/i.test(e)&&!!window.claudeAppBindings}(r=o||(o={})).cmdK="cmdK",r.googleAuthCode="googleAuthCode";let u=()=>{let e=window.navigator.userAgent.match(/Claude\/([0-9.]+)/);return e?e[1]:null};function l(){let e=u();return!!e&&(0,a.gte)(e,"0.3.7")}function d(e,t){(0,s.useEffect)(()=>{var n;if(c())return null===(n=window.claudeAppBindings)||void 0===n||n.registerBinding(e,t),()=>{var t;null===(t=window.claudeAppBindings)||void 0===t||t.unregisterBinding(e)}},[e,t])}},15489:function(e,t,n){n.d(t,{An:function(){return C},HZ:function(){return q},JP:function(){return o},Km:function(){return x},VA:function(){return p},kE:function(){return l},l2:function(){return v},tE:function(){return R},w0:function(){return z},yc:function(){return d}});var r,o,s,a=n(97712),i=n(92068),c=n(6932);(r=o||(o={})).Text="text/plain",r.Markdown="text/markdown",r.Html="text/html",r.Code="application/vnd.ant.code",r.Svg="image/svg+xml",r.Mermaid="application/vnd.ant.mermaid",r.React="application/vnd.ant.react",(s||(s={})).Repl="application/vnd.ant.repl";let u=a.z.string().nullish().transform(e=>null!=e?e:void 0),l=a.z.object({version_uuid:u,command:a.z.enum(["create","update","rewrite"]).optional().catch(void 0),id:u,title:u,type:a.z.nativeEnum(o).optional().catch(void 0),language:u,content:u,old_str:u,new_str:u}),d={"text/plain":{syntaxName:"plaintext",displayName:"text",extension:()=>"txt"},"text/markdown":{syntaxName:"markdown",displayName:"document",extension:()=>"md"},"text/html":{syntaxName:"html",displayName:"website",extension:()=>"html"},"image/svg+xml":{syntaxName:"svg",displayName:"image",extension:()=>"svg"},"application/vnd.ant.code":{syntaxName:"plaintext",displayName:"code",extension:e=>{switch(null==e?void 0:e.language){case"python":return"py";case"javascript":return"js";case"typescript":return"ts";case"java":return"java";case"csharp":return"cs";case"go":return"go";case"rust":return"rs";case"ruby":return"rb";case"php":return"php";case"swift":return"swift";case"kotlin":return"kt";case"dart":return"dart";case"scala":return"scala";case"perl":return"pl";case"elixir":return"ex";case"haskell":return"hs";case"clojure":return"clj";case"r":return"r";case"groovy":return"groovy";case"bash":return"sh";case"css":return"css";case"scss":return"scss";case"less":return"less";case"sql":return"sql";case"graphql":return"graphql";case"json":return"json";case"html":return"html";default:return"txt"}}},"application/vnd.ant.mermaid":{syntaxName:"mermaid",displayName:"diagram",extension:()=>"mermaid"},"application/vnd.ant.react":{syntaxName:"tsx",displayName:"component",extension:()=>"tsx"}},p=e=>{let t=d[e.type];return"application/vnd.ant.code"!==e.type?t.extension():t.extension(e)},h="antArtifact",m="<".concat(h,"(?:\\s+([^>]*)>|(?!>)\\S*)"),g="</".concat(h,">"),f=RegExp("".concat(m,"([\\s\\S]*?)(?:").concat(g,"|$)"),"g"),y=RegExp("<(?:a(?:n(?:t(?:A(?:r(?:t(?:i(?:f(?:a(?:c(?:t)?)?)?)?)?)?)?)?)?)?)?$","gm"),b=RegExp("".concat(m,"[\\s\\S]*?(?:").concat(g,"|$)"),"g"),x="ANTARTIFACTLINK";function v(e){var t;let n=e.match(/identifier="([^"]*)"/),r=n?n[1]:"",s=e.match(/type="([^"]*)"/),a=s?(t=s[1],Object.values(o).includes(t)?t:"text/plain"):"text/plain",i=e.match(/title="([^"]*)"/),c=i?i[1]:"Untitled artifact",u=e.match(/language="([^"]*)"/),l=u?u[1]:void 0,d=e.match(/isClosed="(true|false)"/);return{id:r,type:a,title:c,language:l,isClosed:d?"true"===d[1]:void 0}}function w(e){return e.replace(y,"")}function z(e){return k(w(e)).replace(f,(e,t,n)=>{if(!t||"string"!=typeof t)return"";{let{type:e,language:r}=v(t);return"text/markdown"!==e&&"string"==typeof n?"```".concat(r||d[e].syntaxName,"\n").concat(n.trimStart(),"\n```"):"\n".concat(n)}})}function C(e){return w(k(e).replace(b,(e,t)=>{let n=e.endsWith(g);return"<".concat(x," ").concat(t,' isClosed="').concat(n,'" />')}))}let R=(e,t)=>"create"===e.command||"rewrite"===e.command?e.content:"update"===e.command?void 0===t?e.new_str:t.includes(e.old_str)?t.replace(e.old_str,e.new_str):t.replace(e.old_str.trim(),e.new_str):null!=t?t:"";function q(e){var t;let n=(0,i.K)(e).matchAll(f),r=[];for(let t of n){let[n,o,s]=t,a=n.endsWith(g);if(!o||!s)continue;let{id:i,type:c,title:u,language:l}=v(o),d={command:"create",message:e.uuid||"",created_at:e.created_at,content:s.trimStart(),isClosed:a};r.push({id:i,currentVersion:d,type:c,title:u,language:l})}return null===(t=e.content)||void 0===t||t.map((t,n,o)=>{if("tool_use"===t.type&&"artifacts"===t.name&&t.input){let s;let a=(0,c.n)(t),i=n===o.length-1,{version_uuid:u,command:d,id:p,type:h="text/plain",title:m="",language:g,content:f="",old_str:y="",new_str:b=""}=l.parse(a);"create"===d||"rewrite"===d?s={uuid:u,command:d,message:e.uuid||"",created_at:e.created_at,content:f.trimStart(),isClosed:!i}:"update"===d&&""!==f?s={uuid:u,command:"rewrite",message:e.uuid||"",created_at:e.created_at,isClosed:!i,content:f}:"update"===d&&(s={uuid:u,command:"update",message:e.uuid||"",created_at:e.created_at,isClosed:!i,old_str:y,new_str:b}),void 0!==p&&void 0!==s&&r.push({id:p,currentVersion:s,type:h,title:m,language:g})}}),r}let E="antThinking",S="<".concat(E,">"),_=RegExp("".concat(S,"[\\s\\S]*?(?:</").concat(E,">|$)"),"g"),M=RegExp("<(?:a(?:n(?:t(?:T(?:h(?:i(?:n(?:k(?:i(?:n(?:g)?)?)?)?)?)?)?)?)?)?)?$","gm");function k(e){return e.replace(M,"").replace(_,"")}},24550:function(e,t,n){var r,o;n.d(t,{Y:function(){return r}}),(o=r||(r={})).Image="image",o.Blob="blob",o.SanitizedDocument="document"},90216:function(e,t,n){n.d(t,{g:function(){return r}});function r(e){let t=function(e){let t=[],n=0;for(;n<e.length;){let r=e[n];if(/\s/.test(r)){n++;continue}if("{[]}:,".includes(r)){t.push(r),n++;continue}if('"'===r){let o=r;n++;let s=!1,a=!1;for(;n<e.length;){if(o+=r=e[n],'"'===r&&!s){a=!0;break}s="\\"===r&&!s,n++}if(!a){if(o.slice(-5).includes("\\"))for(o=o.slice(0,o.lastIndexOf("\\"));o.endsWith("\\");)o=o.slice(0,-1);o+='"'}t.push(o),n++;continue}if(/[-0-9]/.test(r)){let r="";for(;n<e.length&&/[-0-9.eE+]/.test(e[n]);)r+=e[n],n++;if(!r.match(/\d$/))for(;r.length>0&&!r[r.length-1].match(/\d/);)r=r.slice(0,-1);t.push(r);continue}if(/[tfn]/.test(r)){let o="",s=["true","false","null"],a=s.filter(e=>e.startsWith(r));if(1===a.length)n+=(o=a[0]).length;else for(;n<e.length&&/[a-z]/.test(e[n])&&(o+=e[n],n++,!s.includes(o)););s.includes(o)&&t.push(o);continue}n++}return t}(e),n=[];for(let e of t)"{"===e||"["===e?n.push("{"===e?"}":"]"):("}"===e||"]"===e)&&n.length>0&&n.pop();n.reverse(),","===t[t.length-1]&&t.pop();let r=t.concat(n).join("");if(""===r)return null;try{return JSON.parse(r)}catch(r){let e=Math.max(t.lastIndexOf(","),t.lastIndexOf("{"),t.lastIndexOf("["));if(-1!==e){let r=t.slice(0,e+1);return","===r[r.length-1]&&r.pop(),JSON.parse(r.concat(n).join(""))}throw Error("Invalid JSON")}}},6932:function(e,t,n){n.d(t,{n:function(){return o}});var r=n(90216);let o=e=>{if(e.input&&Object.keys(e.input).length>0)return e.input;if(e.partial_json){let t={};try{t=(0,r.g)(e.partial_json)}catch(e){}return null!=t?t:{}}return{}}}}]);